# Chezmoi Sync Configuration
# Machine-Aware Auto-Sync System Configuration

# Core Directories
CHEZMOI_SOURCE_DIR="${CHEZMOI_SOURCE_DIR:-$HOME/.local/share/chezmoi}"
BACKUP_DIR="${BACKUP_DIR:-$HOME/.local/share/chezmoi-backups}"
LOG_DIR="${LOG_DIR:-$HOME/Library/Logs/chezmoi}"
SCRIPTS_DIR="${SCRIPTS_DIR:-$HOME/scripts}"

# Lock and State Files  
LOCK_DIR="${LOCK_DIR:-/tmp}"
PUSH_LOCK_FILE="${LOCK_DIR}/chezmoi-push.lock"
PULL_LOCK_FILE="${LOCK_DIR}/chezmoi-pull.lock"
DEV_MODE_FILE="${DEV_MODE_FILE:-$HOME/.config/chezmoi-sync/.dev-mode}"
SYNC_STATE_FILE="${SYNC_STATE_FILE:-$HOME/.config/chezmoi-sync/.sync-state}"
LAST_SYNC_FILE="${LAST_SYNC_FILE:-$HOME/.local/share/chezmoi/.last-sync}"

# Log Files
PUSH_LOG_FILE="${LOG_DIR}/push.log"
PULL_LOG_FILE="${LOG_DIR}/pull.log"
DEV_MODE_LOG_FILE="${LOG_DIR}/dev-mode.log"

# Git Configuration (Updated for Machine-Aware Branching)
GIT_MAIN_BRANCH="${GIT_MAIN_BRANCH:-main}"
GIT_REMOTE="${GIT_REMOTE:-origin}"
GIT_AUTO_SYNC_PREFIX="${GIT_AUTO_SYNC_PREFIX:-auto-sync}"

# Retry and Timeout Configuration
MAX_RETRIES="${MAX_RETRIES:-3}"
RETRY_DELAY="${RETRY_DELAY:-5}"
LOCK_TIMEOUT="${LOCK_TIMEOUT:-30}"

# Validation and Safety
REQUIRE_VERIFICATION="${REQUIRE_VERIFICATION:-true}"
ENABLE_BACKUPS="${ENABLE_BACKUPS:-true}"
MAX_BACKUPS="${MAX_BACKUPS:-10}"
ENABLE_CONFLICT_DETECTION="${ENABLE_CONFLICT_DETECTION:-true}"
ENABLE_LOCK_FILES="${ENABLE_LOCK_FILES:-true}"

# Change Detection
ENABLE_SIGNIFICANCE_FILTER="${ENABLE_SIGNIFICANCE_FILTER:-true}"

# Trivial file patterns (space-separated)
TRIVIAL_PATTERNS="${TRIVIAL_PATTERNS:-*.tmp *.swp *.test *.log *.bak .DS_Store *.history *.cache *.local}"

# Significant file patterns for priority processing
SIGNIFICANT_PATTERNS="${SIGNIFICANT_PATTERNS:-*.sh *.tmpl *.yaml *.toml *.conf CLAUDE.md dot_* run_*}"

# Notification Settings
ENABLE_NOTIFICATIONS="${ENABLE_NOTIFICATIONS:-true}"
NOTIFICATION_TITLE="${NOTIFICATION_TITLE:-Chezmoi Sync}"
NOTIFICATION_SOUND="${NOTIFICATION_SOUND:-false}"

# Development Mode Defaults
DEV_MODE_DEFAULT_TIMEOUT="${DEV_MODE_DEFAULT_TIMEOUT:-4}"

# Sync Intervals (in seconds) - Updated
PUSH_INTERVAL="${PUSH_INTERVAL:-300}"  # 5 minutes
PULL_INTERVAL="${PULL_INTERVAL:-300}"  # 5 minutes  
PUSH_THROTTLE="${PUSH_THROTTLE:-5}"    # 5 seconds

# Logging - Enhanced
LOG_LEVEL="${LOG_LEVEL:-INFO}"  # DEBUG, INFO, WARNING, ERROR
DEBUG_MODE="${DEBUG_MODE:-false}"
VERBOSE_LOGGING="${VERBOSE_LOGGING:-false}"
LOG_RETENTION_DAYS="${LOG_RETENTION_DAYS:-30}"

# Machine Detection (override automatic detection if needed)
# MACHINE_ID="mac-mini-home"  # Uncomment to override auto-detection

# LaunchAgent Configuration  
LAUNCH_AGENTS_DIR="$HOME/Library/LaunchAgents"
AUTOPUSH_PLIST="$LAUNCH_AGENTS_DIR/com.chezmoi.autopush.plist"
AUTOPULL_PLIST="$LAUNCH_AGENTS_DIR/com.chezmoi.autopull.plist"

# Git Integration - Enhanced
GIT_COMMIT_TEMPLATE="${GIT_COMMIT_TEMPLATE:-Auto-sync from %MACHINE% - %TIMESTAMP%}"
GIT_PUSH_OPTIONS="${GIT_PUSH_OPTIONS:-}"
GIT_PULL_OPTIONS="${GIT_PULL_OPTIONS:---rebase --autostash}"

# Security Settings
ENABLE_SECRET_SCANNING="${ENABLE_SECRET_SCANNING:-true}"
SECRET_PATTERNS="${SECRET_PATTERNS:-PRIVATE.*KEY password.*= token.*= api.*key}"

# Performance Tuning
ENABLE_PARALLEL_PROCESSING="${ENABLE_PARALLEL_PROCESSING:-false}"
ENABLE_COMPRESSION="${ENABLE_COMPRESSION:-false}"
COMPRESSION_LEVEL="${COMPRESSION_LEVEL:-6}"
IO_NICE_PRIORITY="${IO_NICE_PRIORITY:-3}"
CPU_NICE_PRIORITY="${CPU_NICE_PRIORITY:-10}"

# Hooks and Extensions (for future use)
PRE_PUSH_HOOK="${PRE_PUSH_HOOK:-}"
POST_PUSH_HOOK="${POST_PUSH_HOOK:-}"
PRE_PULL_HOOK="${PRE_PULL_HOOK:-}"
POST_PULL_HOOK="${POST_PULL_HOOK:-}"

# Export all configuration variables for script usage
export CHEZMOI_SOURCE_DIR BACKUP_DIR LOG_DIR SCRIPTS_DIR
export PUSH_LOCK_FILE PULL_LOCK_FILE DEV_MODE_FILE SYNC_STATE_FILE LAST_SYNC_FILE
export PUSH_LOG_FILE PULL_LOG_FILE DEV_MODE_LOG_FILE
export GIT_MAIN_BRANCH GIT_REMOTE GIT_AUTO_SYNC_PREFIX
export MAX_RETRIES RETRY_DELAY LOCK_TIMEOUT
export REQUIRE_VERIFICATION ENABLE_BACKUPS MAX_BACKUPS ENABLE_CONFLICT_DETECTION ENABLE_LOCK_FILES
export ENABLE_SIGNIFICANCE_FILTER TRIVIAL_PATTERNS SIGNIFICANT_PATTERNS
export ENABLE_NOTIFICATIONS NOTIFICATION_TITLE NOTIFICATION_SOUND
export DEV_MODE_DEFAULT_TIMEOUT
export PUSH_INTERVAL PULL_INTERVAL PUSH_THROTTLE
export LOG_LEVEL DEBUG_MODE VERBOSE_LOGGING LOG_RETENTION_DAYS
export LAUNCH_AGENTS_DIR AUTOPUSH_PLIST AUTOPULL_PLIST
export GIT_COMMIT_TEMPLATE GIT_PUSH_OPTIONS GIT_PULL_OPTIONS
export ENABLE_SECRET_SCANNING SECRET_PATTERNS
export ENABLE_PARALLEL_PROCESSING ENABLE_COMPRESSION COMPRESSION_LEVEL IO_NICE_PRIORITY CPU_NICE_PRIORITY
export PRE_PUSH_HOOK POST_PUSH_HOOK PRE_PULL_HOOK POST_PULL_HOOK